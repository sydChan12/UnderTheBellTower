<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Under the Bell Tower | Purdue Social Deduction</title>
    <style>
        :root { --p-gold: #CEB888; --p-black: #000000; --iu-red: #990000; --bg: #121212; }
        body { background: var(--bg); color: white; font-family: 'Garamond', serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar inspired by secret-hitler.online */
        #player-sidebar { width: 260px; background: #000; border-right: 2px solid var(--p-gold); padding: 20px; display: flex; flex-direction: column; }
        .player-slot { background: #1a1a1a; margin: 5px 0; padding: 12px; border-radius: 4px; border-left: 4px solid #444; transition: 0.3s; }
        .player-slot.active { border-left-color: var(--p-gold); background: #222; }

        #game-board { flex-grow: 1; padding: 40px; display: flex; flex-direction: column; align-items: center; justify-content: space-around; }
        
        /* Policy Tracks */
        .track { display: flex; gap: 12px; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; border: 1px solid #333; }
        .slot { width: 90px; height: 130px; border: 2px dashed #444; border-radius: 6px; position: relative; display: flex; align-items: center; justify-content: center; text-align: center; font-size: 0.7rem; font-weight: bold; transition: all 0.5s ease; }
        .slot.tradition { background: var(--p-gold); color: black; border-style: solid; box-shadow: 0 0 15px var(--p-gold); }
        .slot.construction { background: var(--iu-red); color: white; border-style: solid; box-shadow: 0 0 15px var(--iu-red); }

        /* Election Tracker */
        #election-tracker { display: flex; gap: 10px; margin: 20px 0; }
        .dot { width: 25px; height: 25px; border-radius: 50%; border: 2px solid #555; }
        .dot.active { background: var(--p-gold); box-shadow: 0 0 10px var(--p-gold); }

        /* Action Buttons */
        .btn-gold { background: var(--p-gold); color: black; padding: 12px 24px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn-gold:hover { background: #e0ca9e; }
        
        #vote-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; display: none; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="player-sidebar">
        <h2 style="color: var(--p-gold); letter-spacing: 2px;">CAMPUS DIRECTORY</h2>
        <div id="player-list"></div>
        <div style="margin-top: auto; padding: 10px; border-top: 1px solid #333;">
            <p id="my-role-display">Role: [Hidden]</p>
            <button class="btn-gold" style="width: 100%" onmousedown="revealRole()" onmouseup="hideRole()">Hold to Reveal</button>
        </div>
    </div>

    <div id="game-board">
        <div id="status-bar" style="color: var(--p-gold); font-size: 1.2rem; height: 30px;">Waiting for players...</div>
        
        <div>
            <h4>TRADITION TRACK (Boilermakers)</h4>
            <div class="track" id="tradition-track"></div>
        </div>

        <div>
            <h4>CONSTRUCTION TRACK (Hoosiers)</h4>
            <div class="track" id="construction-track"></div>
        </div>

        <div id="election-tracker-ui">
            <p>ELECTION TRACKER</p>
            <div id="election-tracker">
                <div class="dot" id="dot-0"></div>
                <div class="dot" id="dot-1"></div>
                <div class="dot" id="dot-2"></div>
                <div class="dot" id="dot-3"></div> </div>
        </div>

        <div id="controls">
            <input id="vp-nominee" placeholder="Target Student Name" style="padding: 10px; background: #222; border: 1px solid #444; color: white;">
            <button class="btn-gold" onclick="nominate()">Nominate VP</button>
            <button id="draw-btn" class="btn-gold" style="display:none; margin-left: 10px;" onclick="drawCards()">Draw 3 Policies</button>
        </div>
    </div>

    <div id="vote-overlay">
        <h1 id="vote-header">ELECT NEW GOVERNMENT?</h1>
        <div style="display: flex; gap: 40px; margin-top: 30px;">
            <button class="btn-gold" onclick="castVote('Boiler Up!')" style="font-size: 2rem; padding: 40px;">ðŸš‚ BOILER UP!</button>
            <button onclick="castVote('Hammer Down!')" style="background: var(--iu-red); color: white; font-size: 2rem; padding: 40px; border: none; cursor: pointer; border-radius: 4px;">ðŸ”¨ HAMMER DOWN!</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myRole = "Unknown";

        function updateBoard(data) {
            // Render Tradition Track
            const tt = document.getElementById('tradition-track');
            tt.innerHTML = '';
            for(let i=0; i<5; i++) {
                const filled = data.tradition[i];
                tt.innerHTML += `<div class="slot ${filled ? 'tradition' : ''}">${filled ? 'TRADITION' : i+1}</div>`;
            }

            // Render Construction Track
            const ct = document.getElementById('construction-track');
            ct.innerHTML = '';
            for(let i=0; i<6; i++) {
                const filled = data.construction[i];
                ct.innerHTML += `<div class="slot ${filled ? 'construction' : ''}">${filled ? 'CONSTRUCTION' : i+1}</div>`;
            }

            // Update Election Tracker
            for(let i=0; i<=3; i++) {
                document.getElementById(`dot-${i}`).className = `dot ${i === data.tracker ? 'active' : ''}`;
            }
        }

        socket.on('showVote', (names) => {
            document.getElementById('vote-header').innerText = `ELECT ${names.pres} & ${names.vp}?`;
            document.getElementById('vote-overlay').style.display = 'flex';
        });

        function castVote(choice) {
            socket.emit('submitVote', { choice });
            document.getElementById('vote-overlay').style.display = 'none';
        }

        function revealRole() { document.getElementById('my-role-display').innerText = `Role: ${myRole}`; }
        function hideRole() { document.getElementById('my-role-display').innerText = `Role: [Hidden]`; }
    </script>
</body>
</html>